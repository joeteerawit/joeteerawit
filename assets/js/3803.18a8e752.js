"use strict";(self.webpackChunkjoeteerawit=self.webpackChunkjoeteerawit||[]).push([[3803],{5673:(t,e,a)=>{a.d(e,{a:()=>n});var r=a(844),i=a(6375);function n(t){var e={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:d(t),edges:l(t)};return(0,r.D)(t.graph())||(e.value=(0,r.e)(t.graph())),e}function d(t){return(0,r.s)(t.nodes(),(function(e){var a=t.node(e),i=t.parent(e),n={v:e};return(0,r.D)(a)||(n.value=a),(0,r.D)(i)||(n.parent=i),n}))}function l(t){return(0,r.s)(t.edges(),(function(e){var a=t.edge(e),i={v:e.v,w:e.w};return(0,r.D)(e.name)||(i.name=e.name),(0,r.D)(a)||(i.value=a),i}))}(0,i.a)(n,"write"),(0,i.a)(d,"writeNodes"),(0,i.a)(l,"writeEdges")},5729:(t,e,a)=>{a.d(e,{a:()=>h,b:()=>y,c:()=>w,d:()=>x,e:()=>S});var r=a(6440),i=a(4164),n=a(4188),d=a(6449),l=a(6304),s=a(6375),o=(0,s.a)(((t,e,a,r)=>{e.forEach((e=>{c[e](t,a,r)}))}),"insertMarkers"),c={extension:(0,s.a)(((t,e,a)=>{l.b.trace("Making markers for ",a),t.append("defs").append("marker").attr("id",a+"_"+e+"-extensionStart").attr("class","marker extension "+e).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id",a+"_"+e+"-extensionEnd").attr("class","marker extension "+e).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")}),"extension"),composition:(0,s.a)(((t,e,a)=>{t.append("defs").append("marker").attr("id",a+"_"+e+"-compositionStart").attr("class","marker composition "+e).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",a+"_"+e+"-compositionEnd").attr("class","marker composition "+e).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")}),"composition"),aggregation:(0,s.a)(((t,e,a)=>{t.append("defs").append("marker").attr("id",a+"_"+e+"-aggregationStart").attr("class","marker aggregation "+e).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",a+"_"+e+"-aggregationEnd").attr("class","marker aggregation "+e).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")}),"aggregation"),dependency:(0,s.a)(((t,e,a)=>{t.append("defs").append("marker").attr("id",a+"_"+e+"-dependencyStart").attr("class","marker dependency "+e).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",a+"_"+e+"-dependencyEnd").attr("class","marker dependency "+e).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")}),"dependency"),lollipop:(0,s.a)(((t,e,a)=>{t.append("defs").append("marker").attr("id",a+"_"+e+"-lollipopStart").attr("class","marker lollipop "+e).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6),t.append("defs").append("marker").attr("id",a+"_"+e+"-lollipopEnd").attr("class","marker lollipop "+e).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)}),"lollipop"),point:(0,s.a)(((t,e,a)=>{t.append("marker").attr("id",a+"_"+e+"-pointEnd").attr("class","marker "+e).attr("viewBox","0 0 10 10").attr("refX",6).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),t.append("marker").attr("id",a+"_"+e+"-pointStart").attr("class","marker "+e).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")}),"point"),circle:(0,s.a)(((t,e,a)=>{t.append("marker").attr("id",a+"_"+e+"-circleEnd").attr("class","marker "+e).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),t.append("marker").attr("id",a+"_"+e+"-circleStart").attr("class","marker "+e).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")}),"circle"),cross:(0,s.a)(((t,e,a)=>{t.append("marker").attr("id",a+"_"+e+"-crossEnd").attr("class","marker cross "+e).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),t.append("marker").attr("id",a+"_"+e+"-crossStart").attr("class","marker cross "+e).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")}),"cross"),barb:(0,s.a)(((t,e,a)=>{t.append("defs").append("marker").attr("id",a+"_"+e+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")}),"barb")},h=o,g=(0,s.a)(((t,e,a,r,i)=>{e.arrowTypeStart&&f(t,"start",e.arrowTypeStart,a,r,i),e.arrowTypeEnd&&f(t,"end",e.arrowTypeEnd,a,r,i)}),"addEdgeMarkers"),p={arrow_cross:"cross",arrow_point:"point",arrow_barb:"barb",arrow_circle:"circle",aggregation:"aggregation",extension:"extension",composition:"composition",dependency:"dependency",lollipop:"lollipop"},f=(0,s.a)(((t,e,a,r,i,n)=>{let d=p[a];if(!d)return void l.b.warn(`Unknown arrow type: ${a}`);let s="start"===e?"Start":"End";t.attr(`marker-${e}`,`url(${r}#${i}_${n}-${d}${s})`)}),"addEdgeMarker"),b={},u={},y=(0,s.a)((()=>{b={},u={}}),"clear"),w=(0,s.a)(((t,e)=>{let a=(0,l.X)(),i=(0,l.G)(a.flowchart.htmlLabels),d="markdown"===e.labelType?(0,n.d)(t,e.label,{style:e.labelStyle,useHtmlLabels:i,addSvgBackground:!0},a):(0,r.a)(e.label,e.labelStyle),s=t.insert("g").attr("class","edgeLabel"),o=s.insert("g").attr("class","label");o.node().appendChild(d);let c,h=d.getBBox();if(i){let t=d.children[0],e=(0,l.fa)(d);h=t.getBoundingClientRect(),e.attr("width",h.width),e.attr("height",h.height)}if(o.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),b[e.id]=s,e.width=h.width,e.height=h.height,e.startLabelLeft){let a=(0,r.a)(e.startLabelLeft,e.labelStyle),i=t.insert("g").attr("class","edgeTerminals"),n=i.insert("g").attr("class","inner");c=n.node().appendChild(a);let d=a.getBBox();n.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),u[e.id]||(u[e.id]={}),u[e.id].startLeft=i,m(c,e.startLabelLeft)}if(e.startLabelRight){let a=(0,r.a)(e.startLabelRight,e.labelStyle),i=t.insert("g").attr("class","edgeTerminals"),n=i.insert("g").attr("class","inner");c=i.node().appendChild(a),n.node().appendChild(a);let d=a.getBBox();n.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),u[e.id]||(u[e.id]={}),u[e.id].startRight=i,m(c,e.startLabelRight)}if(e.endLabelLeft){let a=(0,r.a)(e.endLabelLeft,e.labelStyle),i=t.insert("g").attr("class","edgeTerminals"),n=i.insert("g").attr("class","inner");c=n.node().appendChild(a);let d=a.getBBox();n.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),i.node().appendChild(a),u[e.id]||(u[e.id]={}),u[e.id].endLeft=i,m(c,e.endLabelLeft)}if(e.endLabelRight){let a=(0,r.a)(e.endLabelRight,e.labelStyle),i=t.insert("g").attr("class","edgeTerminals"),n=i.insert("g").attr("class","inner");c=n.node().appendChild(a);let d=a.getBBox();n.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),i.node().appendChild(a),u[e.id]||(u[e.id]={}),u[e.id].endRight=i,m(c,e.endLabelRight)}return d}),"insertEdgeLabel");function m(t,e){(0,l.X)().flowchart.htmlLabels&&t&&(t.style.width=9*e.length+"px",t.style.height="12px")}(0,s.a)(m,"setTerminalWidth");var x=(0,s.a)(((t,e)=>{l.b.debug("Moving label abc88 ",t.id,t.label,b[t.id],e);let a=e.updatedPath?e.updatedPath:e.originalPath,r=(0,l.X)(),{subGraphTitleTotalMargin:n}=(0,i.a)(r);if(t.label){let r=b[t.id],i=t.x,s=t.y;if(a){let r=d.m.calcLabelPosition(a);l.b.debug("Moving label "+t.label+" from (",i,",",s,") to (",r.x,",",r.y,") abc88"),e.updatedPath&&(i=r.x,s=r.y)}r.attr("transform",`translate(${i}, ${s+n/2})`)}if(t.startLabelLeft){let e=u[t.id].startLeft,r=t.x,i=t.y;if(a){let e=d.m.calcTerminalLabelPosition(t.arrowTypeStart?10:0,"start_left",a);r=e.x,i=e.y}e.attr("transform",`translate(${r}, ${i})`)}if(t.startLabelRight){let e=u[t.id].startRight,r=t.x,i=t.y;if(a){let e=d.m.calcTerminalLabelPosition(t.arrowTypeStart?10:0,"start_right",a);r=e.x,i=e.y}e.attr("transform",`translate(${r}, ${i})`)}if(t.endLabelLeft){let e=u[t.id].endLeft,r=t.x,i=t.y;if(a){let e=d.m.calcTerminalLabelPosition(t.arrowTypeEnd?10:0,"end_left",a);r=e.x,i=e.y}e.attr("transform",`translate(${r}, ${i})`)}if(t.endLabelRight){let e=u[t.id].endRight,r=t.x,i=t.y;if(a){let e=d.m.calcTerminalLabelPosition(t.arrowTypeEnd?10:0,"end_right",a);r=e.x,i=e.y}e.attr("transform",`translate(${r}, ${i})`)}}),"positionEdgeLabel"),k=(0,s.a)(((t,e)=>{let a=t.x,r=t.y,i=Math.abs(e.x-a),n=Math.abs(e.y-r),d=t.width/2,l=t.height/2;return i>=d||n>=l}),"outsideNode"),v=(0,s.a)(((t,e,a)=>{l.b.debug(`intersection calc abc89:\n  outsidePoint: ${JSON.stringify(e)}\n  insidePoint : ${JSON.stringify(a)}\n  node        : x:${t.x} y:${t.y} w:${t.width} h:${t.height}`);let r=t.x,i=t.y,n=Math.abs(r-a.x),d=t.width/2,s=a.x<e.x?d-n:d+n,o=t.height/2,c=Math.abs(e.y-a.y),h=Math.abs(e.x-a.x);if(Math.abs(i-e.y)*d>Math.abs(r-e.x)*o){let t=a.y<e.y?e.y-o-i:i-o-e.y;s=h*t/c;let r={x:a.x<e.x?a.x+s:a.x-h+s,y:a.y<e.y?a.y+c-t:a.y-c+t};return 0===s&&(r.x=e.x,r.y=e.y),0===h&&(r.x=e.x),0===c&&(r.y=e.y),l.b.debug(`abc89 topp/bott calc, Q ${c}, q ${t}, R ${h}, r ${s}`,r),r}{s=a.x<e.x?e.x-d-r:r-d-e.x;let t=c*s/h,i=a.x<e.x?a.x+h-s:a.x-h+s,n=a.y<e.y?a.y+t:a.y-t;return l.b.debug(`sides calc abc89, Q ${c}, q ${t}, R ${h}, r ${s}`,{_x:i,_y:n}),0===s&&(i=e.x,n=e.y),0===h&&(i=e.x),0===c&&(n=e.y),{x:i,y:n}}}),"intersection"),L=(0,s.a)(((t,e)=>{l.b.debug("abc88 cutPathAtIntersect",t,e);let a=[],r=t[0],i=!1;return t.forEach((t=>{if(k(e,t)||i)r=t,i||a.push(t);else{let n=v(e,r,t),d=!1;a.forEach((t=>{d=d||t.x===n.x&&t.y===n.y})),a.some((t=>t.x===n.x&&t.y===n.y))||a.push(n),i=!0}})),a}),"cutPathAtIntersect"),S=(0,s.a)((function(t,e,a,r,n,d,s){let o=a.points;l.b.debug("abc88 InsertEdge: edge=",a,"e=",e);let c=!1,h=d.node(e.v);var p=d.node(e.w);p?.intersect&&h?.intersect&&(o=o.slice(1,a.points.length-1),o.unshift(h.intersect(o[0])),o.push(p.intersect(o[o.length-1]))),a.toCluster&&(l.b.debug("to cluster abc88",r[a.toCluster]),o=L(a.points,r[a.toCluster].node),c=!0),a.fromCluster&&(l.b.debug("from cluster abc88",r[a.fromCluster]),o=L(o.reverse(),r[a.fromCluster].node).reverse(),c=!0);let f=o.filter((t=>!Number.isNaN(t.y))),b=l.Ga;a.curve&&("graph"===n||"flowchart"===n)&&(b=a.curve);let u,{x:y,y:w}=(0,i.b)(a),m=(0,l.Ca)().x(y).y(w).curve(b);switch(a.thickness){case"normal":u="edge-thickness-normal";break;case"thick":case"invisible":u="edge-thickness-thick";break;default:u=""}switch(a.pattern){case"solid":u+=" edge-pattern-solid";break;case"dotted":u+=" edge-pattern-dotted";break;case"dashed":u+=" edge-pattern-dashed"}let x=t.append("path").attr("d",m(f)).attr("id",a.id).attr("class"," "+u+(a.classes?" "+a.classes:"")).attr("style",a.style),k="";((0,l.X)().flowchart.arrowMarkerAbsolute||(0,l.X)().state.arrowMarkerAbsolute)&&(k=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,k=k.replace(/\(/g,"\\("),k=k.replace(/\)/g,"\\)")),g(x,a,k,s,n);let v={};return c&&(v.updatedPath=o),v.originalPath=a.points,v}),"insertEdge")},3803:(t,e,a)=>{a.d(e,{diagram:()=>Z});var r=a(5729),i=a(5039),n=a(5673),d=a(6440),l=a(4164),s=a(4188),o=a(5206),c=a(4818),h=a(6449),g=(a(7851),a(6304)),p=(a(844),a(9913),a(1869),a(6375)),f={},b={},u={},y=(0,p.a)((()=>{b={},u={},f={}}),"clear"),w=(0,p.a)(((t,e)=>(g.b.trace("In isDescendant",e," ",t," = ",b[e].includes(t)),!!b[e].includes(t))),"isDescendant"),m=(0,p.a)(((t,e)=>(g.b.info("Descendants of ",e," is ",b[e]),g.b.info("Edge is ",t),t.v!==e&&t.w!==e&&(b[e]?b[e].includes(t.v)||w(t.v,e)||w(t.w,e)||b[e].includes(t.w):(g.b.debug("Tilt, ",e,",not in descendants"),!1)))),"edgeInCluster"),x=(0,p.a)(((t,e,a,r)=>{g.b.warn("Copying children of ",t,"root",r,"data",e.node(t),r);let i=e.children(t)||[];t!==r&&i.push(t),g.b.warn("Copying (nodes) clusterId",t,"nodes",i),i.forEach((i=>{if(e.children(i).length>0)x(i,e,a,r);else{let n=e.node(i);g.b.info("cp ",i," to ",r," with parent ",t),a.setNode(i,n),r!==e.parent(i)&&(g.b.warn("Setting parent",i,e.parent(i)),a.setParent(i,e.parent(i))),t!==r&&i!==t?(g.b.debug("Setting parent",i,t),a.setParent(i,t)):(g.b.info("In copy ",t,"root",r,"data",e.node(t),r),g.b.debug("Not Setting parent for node=",i,"cluster!==rootId",t!==r,"node!==clusterId",i!==t));let d=e.edges(i);g.b.debug("Copying Edges",d),d.forEach((i=>{g.b.info("Edge",i);let n=e.edge(i.v,i.w,i.name);g.b.info("Edge data",n,r);try{m(i,r)?(g.b.info("Copying as ",i.v,i.w,n,i.name),a.setEdge(i.v,i.w,n,i.name),g.b.info("newGraph edges ",a.edges(),a.edge(a.edges()[0]))):g.b.info("Skipping copy of edge ",i.v,"--\x3e",i.w," rootId: ",r," clusterId:",t)}catch(t){g.b.error(t)}}))}g.b.debug("Removing node",i),e.removeNode(i)}))}),"copy"),k=(0,p.a)(((t,e)=>{let a=e.children(t),r=[...a];for(let i of a)u[i]=t,r=[...r,...k(i,e)];return r}),"extractDescendants"),v=(0,p.a)(((t,e)=>{g.b.trace("Searching",t);let a=e.children(t);if(g.b.trace("Searching children of id ",t,a),a.length<1)return g.b.trace("This is a valid node",t),t;for(let r of a){let a=v(r,e);if(a)return g.b.trace("Found replacement for",t," => ",a),a}}),"findNonClusterChild"),L=(0,p.a)((t=>f[t]&&f[t].externalConnections&&f[t]?f[t].id:t),"getAnchorId"),S=(0,p.a)(((t,e)=>{if(!t||e>10)g.b.debug("Opting out, no graph ");else{g.b.debug("Opting in, graph "),t.nodes().forEach((function(e){t.children(e).length>0&&(g.b.warn("Cluster identified",e," Replacement id in edges: ",v(e,t)),b[e]=k(e,t),f[e]={id:v(e,t),clusterData:t.node(e)})})),t.nodes().forEach((function(e){let a=t.children(e),r=t.edges();a.length>0?(g.b.debug("Cluster identified",e,b),r.forEach((t=>{t.v!==e&&t.w!==e&&w(t.v,e)^w(t.w,e)&&(g.b.warn("Edge: ",t," leaves cluster ",e),g.b.warn("Descendants of XXX ",e,": ",b[e]),f[e].externalConnections=!0)}))):g.b.debug("Not a cluster ",e,b)}));for(let e of Object.keys(f)){let a=f[e].id,r=t.parent(a);r!==e&&f[r]&&!f[r].externalConnections&&(f[e].id=r)}t.edges().forEach((function(e){let a=t.edge(e);g.b.warn("Edge "+e.v+" -> "+e.w+": "+JSON.stringify(e)),g.b.warn("Edge "+e.v+" -> "+e.w+": "+JSON.stringify(t.edge(e)));let r=e.v,i=e.w;if(g.b.warn("Fix XXX",f,"ids:",e.v,e.w,"Translating: ",f[e.v]," --- ",f[e.w]),f[e.v]&&f[e.w]&&f[e.v]===f[e.w]){g.b.warn("Fixing and trixing link to self - removing XXX",e.v,e.w,e.name),g.b.warn("Fixing and trixing - removing XXX",e.v,e.w,e.name),r=L(e.v),i=L(e.w),t.removeEdge(e.v,e.w,e.name);let n=e.w+"---"+e.v;t.setNode(n,{domId:n,id:n,labelStyle:"",labelText:a.label,padding:0,shape:"labelRect",style:""});let d=structuredClone(a),l=structuredClone(a);d.label="",d.arrowTypeEnd="none",l.label="",d.fromCluster=e.v,l.toCluster=e.v,t.setEdge(r,n,d,e.name+"-cyclic-special"),t.setEdge(n,i,l,e.name+"-cyclic-special")}else if(f[e.v]||f[e.w]){if(g.b.warn("Fixing and trixing - removing XXX",e.v,e.w,e.name),r=L(e.v),i=L(e.w),t.removeEdge(e.v,e.w,e.name),r!==e.v){let i=t.parent(r);f[i].externalConnections=!0,a.fromCluster=e.v}if(i!==e.w){let r=t.parent(i);f[r].externalConnections=!0,a.toCluster=e.w}g.b.warn("Fix Replacing with XXX",r,i,e.name),t.setEdge(r,i,a,e.name)}})),g.b.warn("Adjusted Graph",(0,n.a)(t)),X(t,0),g.b.trace(f)}}),"adjustClustersAndEdges"),X=(0,p.a)(((t,e)=>{if(g.b.warn("extractor - ",e,(0,n.a)(t),t.children("D")),e>10)return void g.b.error("Bailing out");let a=t.nodes(),r=!1;for(let e of a){let a=t.children(e);r=r||a.length>0}if(r){g.b.debug("Nodes = ",a,e);for(let r of a)if(g.b.debug("Extracting node",r,f,f[r]&&!f[r].externalConnections,!t.parent(r),t.node(r),t.children("D")," Depth ",e),f[r])if(!f[r].externalConnections&&t.children(r)&&t.children(r).length>0){g.b.warn("Cluster without external connections, without a parent and with children",r,e);let a="TB"===t.graph().rankdir?"LR":"TB";f[r]?.clusterData?.dir&&(a=f[r].clusterData.dir,g.b.warn("Fixing dir",f[r].clusterData.dir,a));let i=new c.a({multigraph:!0,compound:!0}).setGraph({rankdir:a,nodesep:50,ranksep:50,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));g.b.warn("Old graph before copy",(0,n.a)(t)),x(r,t,i,r),t.setNode(r,{clusterNode:!0,id:r,clusterData:f[r].clusterData,labelText:f[r].labelText,graph:i}),g.b.warn("New graph after copy node: (",r,")",(0,n.a)(i)),g.b.debug("Old graph after copy",(0,n.a)(t))}else g.b.warn("Cluster ** ",r," **not meeting the criteria !externalConnections:",!f[r].externalConnections," no parent: ",!t.parent(r)," children ",t.children(r)&&t.children(r).length>0,t.children("D"),e),g.b.debug(f);else g.b.debug("Not a cluster",r,e);a=t.nodes(),g.b.warn("New list of nodes",a);for(let r of a){let a=t.node(r);g.b.warn(" Now next level",r,a),a.clusterNode&&X(a.graph,e+1)}}else g.b.debug("Done, no node has children",t.nodes())}),"extractor"),E=(0,p.a)(((t,e)=>{if(0===e.length)return[];let a=Object.assign(e);return e.forEach((e=>{let r=t.children(e),i=E(t,r);a=[...a,...i]})),a}),"sorter"),T=(0,p.a)((t=>E(t,t.children())),"sortNodesByHierarchy"),C=(0,p.a)(((t,e)=>{g.b.info("Creating subgraph rect for ",e.id,e);let a=(0,g.X)(),r=t.insert("g").attr("class","cluster"+(e.class?" "+e.class:"")).attr("id",e.id),i=r.insert("rect",":first-child"),n=(0,g.G)(a.flowchart.htmlLabels),o=r.insert("g").attr("class","cluster-label"),c="markdown"===e.labelType?(0,s.d)(o,e.labelText,{style:e.labelStyle,useHtmlLabels:n},a):o.node().appendChild((0,d.a)(e.labelText,e.labelStyle,void 0,!0)),h=c.getBBox();if((0,g.G)(a.flowchart.htmlLabels)){let t=c.children[0],e=(0,g.fa)(c);h=t.getBoundingClientRect(),e.attr("width",h.width),e.attr("height",h.height)}let p=0*e.padding,f=p/2,b=e.width<=h.width+p?h.width+p:e.width;e.width<=h.width+p?e.diff=(h.width-e.width)/2-e.padding/2:e.diff=-e.padding/2,g.b.trace("Data ",e,JSON.stringify(e)),i.attr("style",e.style).attr("rx",e.rx).attr("ry",e.ry).attr("x",e.x-b/2).attr("y",e.y-e.height/2-f).attr("width",b).attr("height",e.height+p);let{subGraphTitleTopMargin:u}=(0,l.a)(a);n?o.attr("transform",`translate(${e.x-h.width/2}, ${e.y-e.height/2+u})`):o.attr("transform",`translate(${e.x}, ${e.y-e.height/2+u})`);let y=i.node().getBBox();return e.width=y.width,e.height=y.height,e.intersect=function(t){return(0,d.b)(e,t)},r}),"rect"),N=(0,p.a)(((t,e)=>{let a=t.insert("g").attr("class","note-cluster").attr("id",e.id),r=a.insert("rect",":first-child"),i=0*e.padding,n=i/2;r.attr("rx",e.rx).attr("ry",e.ry).attr("x",e.x-e.width/2-n).attr("y",e.y-e.height/2-n).attr("width",e.width+i).attr("height",e.height+i).attr("fill","none");let l=r.node().getBBox();return e.width=l.width,e.height=l.height,e.intersect=function(t){return(0,d.b)(e,t)},a}),"noteGroup"),M={rect:C,roundedWithTitle:(0,p.a)(((t,e)=>{let a=(0,g.X)(),r=t.insert("g").attr("class",e.classes).attr("id",e.id),i=r.insert("rect",":first-child"),n=r.insert("g").attr("class","cluster-label"),s=r.append("rect"),o=n.node().appendChild((0,d.a)(e.labelText,e.labelStyle,void 0,!0)),c=o.getBBox();if((0,g.G)(a.flowchart.htmlLabels)){let t=o.children[0],e=(0,g.fa)(o);c=t.getBoundingClientRect(),e.attr("width",c.width),e.attr("height",c.height)}c=o.getBBox();let h=0*e.padding,p=h/2,f=e.width<=c.width+e.padding?c.width+e.padding:e.width;e.width<=c.width+e.padding?e.diff=(c.width+0*e.padding-e.width)/2:e.diff=-e.padding/2,i.attr("class","outer").attr("x",e.x-f/2-p).attr("y",e.y-e.height/2-p).attr("width",f+h).attr("height",e.height+h),s.attr("class","inner").attr("x",e.x-f/2-p).attr("y",e.y-e.height/2-p+c.height-1).attr("width",f+h).attr("height",e.height+h-c.height-3);let{subGraphTitleTopMargin:b}=(0,l.a)(a);n.attr("transform",`translate(${e.x-c.width/2}, ${e.y-e.height/2-e.padding/3+((0,g.G)(a.flowchart.htmlLabels)?5:3)+b})`);let u=i.node().getBBox();return e.height=u.height,e.intersect=function(t){return(0,d.b)(e,t)},r}),"roundedWithTitle"),noteGroup:N,divider:(0,p.a)(((t,e)=>{let a=t.insert("g").attr("class",e.classes).attr("id",e.id),r=a.insert("rect",":first-child"),i=0*e.padding,n=i/2;r.attr("class","divider").attr("x",e.x-e.width/2-n).attr("y",e.y-e.height/2).attr("width",e.width+i).attr("height",e.height+i);let l=r.node().getBBox();return e.width=l.width,e.height=l.height,e.diff=-e.padding/2,e.intersect=function(t){return(0,d.b)(e,t)},a}),"divider")},B={},$=(0,p.a)(((t,e)=>{g.b.trace("Inserting cluster");let a=e.shape||"rect";B[e.id]=M[a](t,e)}),"insertCluster"),D=(0,p.a)((()=>{B={}}),"clear"),R=(0,p.a)((async(t,e,a,i,s,c)=>{g.b.info("Graph in recursive render: XXX",(0,n.a)(e),s);let h=e.graph().rankdir;g.b.trace("Dir in recursive render - dir:",h);let p=t.insert("g").attr("class","root");e.nodes()?g.b.info("Recursive render XXX",e.nodes()):g.b.info("No nodes found for",e),e.edges().length>0&&g.b.trace("Recursive edges",e.edge(e.edges()[0]));let b=p.insert("g").attr("class","clusters"),u=p.insert("g").attr("class","edgePaths"),y=p.insert("g").attr("class","edgeLabels"),w=p.insert("g").attr("class","nodes");await Promise.all(e.nodes().map((async function(t){let r=e.node(t);if(void 0!==s){let a=JSON.parse(JSON.stringify(s.clusterData));g.b.info("Setting data for cluster XXX (",t,") ",a,s),e.setNode(s.id,a),e.parent(t)||(g.b.trace("Setting parent",t,s.id),e.setParent(t,s.id,a))}if(g.b.info("(Insert) Node XXX"+t+": "+JSON.stringify(e.node(t))),r?.clusterNode){g.b.info("Cluster identified",t,r.width,e.node(t));let{ranksep:n,nodesep:l}=e.graph();r.graph.setGraph({...r.graph.graph(),ranksep:n,nodesep:l});let s=await R(w,r.graph,a,i,e.node(t),c),o=s.elem;(0,d.c)(r,o),r.diff=s.diff||0,g.b.info("Node bounds (abc123)",t,r,r.width,r.x,r.y),(0,d.e)(o,r),g.b.warn("Recursive render complete ",o,r)}else e.children(t).length>0?(g.b.info("Cluster - the non recursive path XXX",t,r.id,r,e),g.b.info(v(r.id,e)),f[r.id]={id:v(r.id,e),node:r}):(g.b.info("Node - the non recursive path",t,r.id,r),await(0,d.d)(w,e.node(t),h))}))),e.edges().forEach((async function(t){let a=e.edge(t.v,t.w,t.name);g.b.info("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(t)),g.b.info("Edge "+t.v+" -> "+t.w+": ",t," ",JSON.stringify(e.edge(t))),g.b.info("Fix",f,"ids:",t.v,t.w,"Translating: ",f[t.v],f[t.w]),await(0,r.c)(y,a)})),e.edges().forEach((function(t){g.b.info("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(t))})),g.b.info("Graph before layout:",JSON.stringify((0,n.a)(e))),g.b.info("#############################################"),g.b.info("###                Layout                 ###"),g.b.info("#############################################"),g.b.info(e),(0,o.a)(e),g.b.info("Graph after layout:",JSON.stringify((0,n.a)(e)));let m=0,{subGraphTitleTotalMargin:x}=(0,l.a)(c);return T(e).forEach((function(t){let a=e.node(t);g.b.info("Position "+t+": "+JSON.stringify(e.node(t))),g.b.info("Position "+t+": ("+a.x,","+a.y,") width: ",a.width," height: ",a.height),a?.clusterNode?(a.y+=x,(0,d.g)(a)):e.children(t).length>0?(a.height+=x,$(b,a),f[a.id].node=a):(a.y+=x/2,(0,d.g)(a))})),e.edges().forEach((function(t){let n=e.edge(t);g.b.info("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(n),n),n.points.forEach((t=>t.y+=x/2));let d=(0,r.e)(u,t,n,f,a,e,i);(0,r.d)(n,d)})),e.nodes().forEach((function(t){let a=e.node(t);g.b.info(t,a.type,a.diff),"group"===a.type&&(m=a.diff)})),{elem:p,diff:m}}),"recursiveRender"),P=(0,p.a)((async(t,e,a,i,l)=>{(0,r.a)(t,a,i,l),(0,d.f)(),(0,r.b)(),D(),y(),g.b.warn("Graph at first:",JSON.stringify((0,n.a)(e))),S(e),g.b.warn("Graph after:",JSON.stringify((0,n.a)(e)));let s=(0,g.X)();await R(t,e,i,l,void 0,s)}),"render"),_=(0,p.a)((t=>g.L.sanitizeText(t,(0,g.X)())),"sanitizeText"),O={dividerMargin:10,padding:5,textHeight:10,curve:void 0},G=(0,p.a)((function(t,e,a,r){g.b.info("keys:",[...t.keys()]),g.b.info(t),t.forEach((function(t){let i={shape:"rect",id:t.id,domId:t.domId,labelText:_(t.id),labelStyle:"",style:"fill: none; stroke: black",padding:(0,g.X)().flowchart?.padding??(0,g.X)().class?.padding};e.setNode(t.id,i),W(t.classes,e,a,r,t.id),g.b.info("setNode",i)}))}),"addNamespaces"),W=(0,p.a)((function(t,e,a,r,i){g.b.info("keys:",[...t.keys()]),g.b.info(t),[...t.values()].filter((t=>t.parent===i)).forEach((function(t){let a=t.cssClasses.join(" "),n=(0,h.d)(t.styles),d=t.label??t.id,l={labelStyle:n.labelStyle,shape:"class_box",labelText:_(d),classData:t,rx:0,ry:0,class:a,style:n.style,id:t.id,domId:t.domId,tooltip:r.db.getTooltip(t.id,i)||"",haveCallback:t.haveCallback,link:t.link,width:"group"===t.type?500:void 0,type:t.type,padding:(0,g.X)().flowchart?.padding??(0,g.X)().class?.padding};e.setNode(t.id,l),i&&e.setParent(t.id,i),g.b.info("setNode",l)}))}),"addClasses"),H=(0,p.a)((function(t,e,a,r){g.b.info(t),t.forEach((function(t,i){let n=t,d=n.text,l={labelStyle:"",shape:"note",labelText:_(d),noteData:n,rx:0,ry:0,class:"",style:"",id:n.id,domId:n.id,tooltip:"",type:"note",padding:(0,g.X)().flowchart?.padding??(0,g.X)().class?.padding};if(e.setNode(n.id,l),g.b.info("setNode",l),!n.class||!r.has(n.class))return;let s=a+i,o={id:`edgeNote${s}`,classes:"relation",pattern:"dotted",arrowhead:"none",startLabelRight:"",endLabelLeft:"",arrowTypeStart:"none",arrowTypeEnd:"none",style:"fill:none",labelStyle:"",curve:(0,h.c)(O.curve,g.Ba)};e.setEdge(n.id,n.class,o,s)}))}),"addNotes"),I=(0,p.a)((function(t,e){let a=(0,g.X)().flowchart,r=0;t.forEach((function(t){r++;let i={classes:"relation",pattern:1==t.relation.lineType?"dashed":"solid",id:(0,h.p)(t.id1,t.id2,{prefix:"id",counter:r}),arrowhead:"arrow_open"===t.type?"none":"normal",startLabelRight:"none"===t.relationTitle1?"":t.relationTitle1,endLabelLeft:"none"===t.relationTitle2?"":t.relationTitle2,arrowTypeStart:A(t.relation.type1),arrowTypeEnd:A(t.relation.type2),style:"fill:none",labelStyle:"",curve:(0,h.c)(a?.curve,g.Ba)};if(g.b.info(i,t),void 0!==t.style){let e=(0,h.d)(t.style);i.style=e.style,i.labelStyle=e.labelStyle}t.text=t.title,void 0===t.text?void 0!==t.style&&(i.arrowheadStyle="fill: #333"):(i.arrowheadStyle="fill: #333",i.labelpos="c",(0,g.X)().flowchart?.htmlLabels??(0,g.X)().htmlLabels?(i.labelType="html",i.label='<span class="edgeLabel">'+t.text+"</span>"):(i.labelType="text",i.label=t.text.replace(g.L.lineBreakRegex,"\n"),void 0===t.style&&(i.style=i.style||"stroke: #333; stroke-width: 1.5px;fill:none"),i.labelStyle=i.labelStyle.replace("color:","fill:"))),e.setEdge(t.id1,t.id2,i,r)}))}),"addRelations"),J=(0,p.a)((function(t){O={...O,...t}}),"setConf"),Y=(0,p.a)((async function(t,e,a,r){g.b.info("Drawing class - ",e);let i=(0,g.X)().flowchart??(0,g.X)().class,n=(0,g.X)().securityLevel;g.b.info("config:",i);let d,l=i?.nodeSpacing??50,s=i?.rankSpacing??50,o=new c.a({multigraph:!0,compound:!0}).setGraph({rankdir:r.db.getDirection(),nodesep:l,ranksep:s,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}})),p=r.db.getNamespaces(),f=r.db.getClasses(),b=r.db.getRelations(),u=r.db.getNotes();g.b.info(b),G(p,o,e,r),W(f,o,e,r),I(b,o),H(u,o,b.length+1,f),"sandbox"===n&&(d=(0,g.fa)("#i"+e));let y="sandbox"===n?(0,g.fa)(d.nodes()[0].contentDocument.body):(0,g.fa)("body"),w=y.select(`[id="${e}"]`),m=y.select("#"+e+" g");if(await P(m,o,["aggregation","extension","composition","dependency","lollipop"],"classDiagram",e),h.m.insertTitle(w,"classTitleText",i?.titleTopMargin??5,r.db.getDiagramTitle()),(0,g.N)(o,w,i?.diagramPadding,i?.useMaxWidth),!i?.htmlLabels){let t="sandbox"===n?d.nodes()[0].contentDocument:document,a=t.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(let e of a){let a=e.getBBox(),r=t.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("rx",0),r.setAttribute("ry",0),r.setAttribute("width",a.width),r.setAttribute("height",a.height),e.insertBefore(r,e.firstChild)}}}),"draw");function A(t){let e;switch(t){case 0:e="aggregation";break;case 1:e="extension";break;case 2:e="composition";break;case 3:e="dependency";break;case 4:e="lollipop";break;default:e="none"}return e}(0,p.a)(A,"getArrowMarker");var U={setConf:J,draw:Y},Z={parser:i.a,db:i.b,renderer:U,styles:i.c,init:(0,p.a)((t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,i.b.clear()}),"init")}}}]);